from flask import Flask, request, jsonify
import json, os

# Import modules
from api.evolve import evolve
from api.chat import chat
from api.legacy_analyzer import legacy_analyze
from api.storage import Storage

app = Flask(__name__)
storage = Storage("niblit_data.json")

@app.route("/api", methods=["POST"])
def main_api():
    data = request.get_json()
    user_input = data.get("message", "")
    
    # Process chat
    response = chat(user_input, storage)
    
    # Evolve AI state
    evolve(storage)
    
    return jsonify({"response": response})

if __name__ == "__main__":
    app.run()
